function _utf8_decode(utftext) {
  let string = "";
  let i = 0;
  let c = 0,
    c2 = 0,
    c3 = 0;

  while (i < utftext.length) {
    c = utftext.charCodeAt(i);

    if (c < 128) {
      string += String.fromCharCode(c);
      i++;
    } else if (c > 191 && c < 224) {
      c2 = utftext.charCodeAt(i + 1);
      string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
      i += 2;
    } else {
      c2 = utftext.charCodeAt(i + 1);
      c3 = utftext.charCodeAt(i + 2);
      string += String.fromCharCode(
        ((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63)
      );
      i += 3;
    }
  }

  return string;
}

function decode(input) {
  let _keyStr =
    "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
  let output = "";
  let chr1, chr2, chr3;
  let enc1, enc2, enc3, enc4;
  let i = 0;

  input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");

  while (i < input.length) {
    enc1 = _keyStr.indexOf(input.charAt(i++));
    enc2 = _keyStr.indexOf(input.charAt(i++));
    enc3 = _keyStr.indexOf(input.charAt(i++));
    enc4 = _keyStr.indexOf(input.charAt(i++));

    chr1 = (enc1 << 2) | (enc2 >> 4);
    chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
    chr3 = ((enc3 & 3) << 6) | enc4;

    output = output + String.fromCharCode(chr1);

    if (enc3 != 64) {
      output = output + String.fromCharCode(chr2);
    }
    if (enc4 != 64) {
      output = output + String.fromCharCode(chr3);
    }
  }

  output = _utf8_decode(output);

  return output;
}

let targetEnv = "";
if (window.location.host === "www.airindia.com")
{
  targetEnv = "prod";
} else if (window.location.host === "newai-staging.airindia.com")
{
  targetEnv = "stage";
} else if (
  window.location.host === "qa.airindia.com"||
  window.location.host === "publish-p104052-e988631.adobeaemcloud.com" ||
  window.location.host === "uat.airindia.com" ||
  window.location.host === "publish-p104052-e1209914.adobeaemcloud.com"
) 
{
  targetEnv = "qa";
} else 
{
  targetEnv = "dev";
}

let breadcrumb = document.querySelectorAll(".breadcrumb span");

let breadcrumbData = "";
breadcrumb.forEach((p) => {
  if (breadcrumbData) {
    breadcrumbData = breadcrumbData + "-" + p.innerHTML;
  } else {
    breadcrumbData = p.innerHTML;
  }
});
let pageTitle = document.title;
let pageNameData = "";
if (breadcrumbData.includes("Book") || breadcrumbData.includes("Manage")) {
  pageNameData = "Book & Manage";
}
if (breadcrumbData.includes("Where We Fly")) {
  pageNameData = "Where We Fly";
}
if (breadcrumbData.includes("Prepare to Travel")) {
  pageNameData = "Prepare to Travel";
}
if (breadcrumbData.includes("Air India Experience")) {
  pageNameData = "Air India Experience";
}
if (breadcrumbData.includes("Flying Returns")) {
  pageNameData = "Loyalty";
}

if (pageNameData == "") {
  if (
    pageTitle.includes("Book") ||
    pageTitle.includes("Manage") ||
    pageTitle.includes("Book & Manage")
  ) {
    pageNameData = "Book & Manage";
  }
  if (pageTitle.includes("Where We Fly")) {
    pageNameData = "Where We Fly";
  }
  if (pageTitle.includes("Prepare to Travel")) {
    pageNameData = "Prepare to Travel";
  }
  if (pageTitle.includes("Air India Experience")) {
    pageNameData = "Air India Experience";
  }
  if (pageTitle.includes("Flying Returns")) {
    pageNameData = "Loyalty";
  }
  if (pageNameData == "") {
    pageNameData = "AEM Site Section";
  }
}

const adobeUrlParams = new URLSearchParams(window.location.search);
const utm_medium = adobeUrlParams.get("utm_medium") || "";
const utm_source = adobeUrlParams.get("utm_source") || "";
const utm_campaign = adobeUrlParams.get("utm_campaign") || "";
const utm_term = adobeUrlParams.get("utm_term") || "";
const utm_content = adobeUrlParams.get("utm_content") || "";

let utm_medium_data = "";
let utm_source_data = "";
let utm_campaign_data = "";
let utm_term_data = "";
let utm_content_data = "";

if (utm_medium != "") {
  utm_medium_data = "utm_medium=" + utm_medium;
} else {
  utm_medium_data = "";
}

if (utm_source != "") {
  if (utm_medium_data != "") {
    utm_source_data = "&utm_source=" + utm_source;
  } else {
    utm_source_data = "utm_source=" + utm_source;
  }
} else {
  utm_source_data = "";
}

if (utm_campaign != "") {
  if (utm_medium_data != "" || utm_source_data != "") {
    utm_campaign_data = "&utm_campaign=" + utm_campaign;
  } else {
    utm_campaign_data = "utm_campaign=" + utm_campaign;
  }
} else {
  utm_campaign_data = "";
}

if (utm_term != "") {
  if (
    utm_medium_data != "" ||
    utm_source_data != "" ||
    utm_campaign_data != ""
  ) {
    utm_term_data = "&utm_term=" + utm_term;
  } else {
    utm_term_data = "utm_term=" + utm_term;
  }
} else {
  utm_term_data = "";
}

if (utm_content != "") {
  if (
    utm_medium_data != "" ||
    utm_source_data != "" ||
    utm_campaign_data != "" ||
    utm_term_data != ""
  ) {
    utm_content_data = "&utm_content=" + utm_content;
  } else {
    utm_content_data = "utm_content=" + utm_content;
  }
} else {
  utm_content_data = "";
}

const urlParamsValue =
  utm_medium_data +
  utm_source_data +
  utm_campaign_data +
  utm_term_data +
  utm_content_data;

let targetData = {
  event: "pageLoaded",
  _airindia: {
    pageName: document.title,
    pageURL: window.location.href,
    siteSection: pageNameData,
    siteSubSection: document.title,
    pageType: "AEM Page",
    siteName: "AirIndia Website",
    language: document.documentElement.lang,
    market: "",
  },

  web: {
    webPageDetails: {
      URL: window.location.href,
      name: document.title,
      server: document.location.hostname,
      siteSection: pageNameData,
      pageViews: {
        value: 1,
      },
    },
  },

  marketing: {
    trackingCode: urlParamsValue,
  },
};

if (window.sessionStorage.getItem("isSigninRequested") != null) {
  if (window.sessionStorage.getItem("lty-md") !== null) {
    let userData = JSON.parse(
      decode(JSON.stringify(window.sessionStorage.getItem("lty-md")))
    );
    let memTier = decode(window.sessionStorage.getItem("lty-memTier"));
    let membershipId = userData.membershipId;
    targetData._airindia["userInfo"] = {
      id: membershipId,
      status: "authenticated",
      membershipTier: memTier,
    };
    if (window.adobeDataLayer) {
      window.adobeDataLayer.push(targetData);
    }
  }
} else {
  if (window.adobeDataLayer) window.adobeDataLayer.push(targetData);
}

function findUpTag(el, tag) {
  if (el.tagName === tag) return el;
  while (el.parentNode) {
    el = el.parentNode;
    if (el.tagName === tag) return el;
  }
  return null;
}

document.addEventListener("click", (event) => {
  targetClick(event);
});

function targetClick(event) {
  let dataTarget = event.target;
  let websiteDomain = window.location.origin;
  let webType = "other";

  if (dataTarget?.localName == "a" || dataTarget?.localName == "img") {
    dataTarget = findUpTag(event.target, "A");
  }

  if (dataTarget?.localName == "b") {
      if (dataTarget.parentElement?.localName == "a") {
        dataTarget = findUpTag(event.target, "A");
      }
    }

    if (dataTarget?.localName == "span") {
      if (dataTarget.parentElement?.localName == "a") {
        dataTarget = findUpTag(event.target, "A");
      }
    }

  if (dataTarget == null) {
    dataTarget = event.target;
  }

  if (dataTarget) {
    if (
      dataTarget?.href?.toLowerCase().indexOf(document.domain.toLowerCase()) ==
      -1
    ) {
      webType = "exit";
    }

    let breadcrumb = document.querySelectorAll(".breadcrumb span");

    let breadcrumbData = "";
    breadcrumb.forEach((p) => {
      if (breadcrumbData) {
        breadcrumbData = breadcrumbData + "-" + p.innerHTML;
      } else {
        breadcrumbData = p.innerHTML;
      }
    });

    let pageTitle = document.title;
    let pageNameData = "";
    if (breadcrumbData.includes("Book") || breadcrumbData.includes("Manage")) {
      pageNameData = "Book & Manage";
    }
    if (breadcrumbData.includes("Where We Fly")) {
      pageNameData = "Where We Fly";
    }
    if (breadcrumbData.includes("Prepare to Travel")) {
      pageNameData = "Prepare to Travel";
    }
    if (breadcrumbData.includes("Air India Experience")) {
      pageNameData = "Air India Experience";
    }
    if (breadcrumbData.includes("Flying Returns")) {
      pageNameData = "Loyalty";
    }

    if (pageNameData == "") {
      if (
        pageTitle.includes("Book") ||
        pageTitle.includes("Manage") ||
        pageTitle.includes("Book & Manage")
      ) {
        pageNameData = "Book & Manage";
      }
      if (pageTitle.includes("Where We Fly")) {
        pageNameData = "Where We Fly";
      }
      if (pageTitle.includes("Prepare to Travel")) {
        pageNameData = "Prepare to Travel";
      }
      if (pageTitle.includes("Air India Experience")) {
        pageNameData = "Air India Experience";
      }
      if (pageTitle.includes("Flying Returns")) {
        pageNameData = "Loyalty";
      }
      if (pageNameData == "") {
        pageNameData = "AEM Site Section";
      }
    }

    let clickName = dataTarget.innerText;

    if (dataTarget.href) {
      clickName = dataTarget.title
        ? dataTarget.title
        : dataTarget.innerHTML
            .replace(/(<([^>]+)>)/gi, "")
            .replaceAll("\n", "")
            .trim();
      if (clickName == "" && dataTarget.hasAttribute("org_title")) {
        clickName = dataTarget.getAttribute("org_title");
      }
      clickName =
        clickName.indexOf("(opens in a new tab)") != -1
          ? clickName.replaceAll("(opens in a new tab)", "")
          : clickName;
      clickName =
        clickName.indexOf("&amp;") != -1
          ? clickName.replaceAll("&amp;", "&")
          : clickName;
    }

    if (clickName?.includes("\n")) {
      clickName = clickName.replace(/\n/g, " ");
    }

    if (clickName == "" && dataTarget.hasAttribute("title")) {
      clickName = dataTarget.getAttribute("title");
    }

    let componentName = dataTarget?.name
      ? dataTarget?.name
      : dataTarget?.innerText;
    if (componentName?.includes("\n")) {
      componentName = componentName.replace(/\n/g, " ");
    }

    let targetData = {
      event: "Click",
      _airindia: {
        pageName: document.title,
        pageURL: window.location.href,
        siteSection: pageNameData,
        siteSubSection: document.title,
        pageType: "AEM Page",
        siteName: "AirIndia Website",
        language: document.documentElement.lang,
        market: "",
        clickInfo: {
          clickName: clickName,
          clickComponentType:
            dataTarget?.localName == "a"
              ? "URL"
              : "Button" /*"<Banner/Button/URL>"*/,
          componentName: componentName,
          componentID: dataTarget?.id,
        },
      },

      web: {
        webInteractions: {
          linkClicks: {
            value: 1,
          },
          name: event.target.innerHTML
            .replace(/(<([^>]+)>)/gi, "")
            .replaceAll("\n", " ")
            .trim(),
          type: "other",
          URL: dataTarget.href ? dataTarget.href : "",
        },
      },
    };

    if (window.sessionStorage.getItem("lyt-ud") !== null) {
      let userData = JSON.parse(
        decode(JSON.stringify(window.sessionStorage.getItem("lty-md")))
      );
      let memTier = decode(window.sessionStorage.getItem("lty-memTier"));
      let membershipId = userData.membershipId;
      targetData._airindia["userInfo"] = {
        id: membershipId,
        status: "authenticated",
        membershipTier: memTier,
      };
    }

    // Data layer for header sub menu
    if (
      event.target.parentNode?.parentNode?.parentNode?.parentNode?.parentNode?.parentNode?.children[0].id.includes(
        "headernav"
      )
    ) {
      targetData._airindia["clickInfo"].clickLocation = "Header";
      targetData._airindia["clickInfo"].menuName=
          event.target.parentNode?.parentNode?.parentNode?.parentNode
            ?.parentNode?.parentNode?.children[0]?.innerText
      let headerMenuRegex = /headernav[0-99]menu[0-99]/;
      if (headerMenuRegex.test(event.target.id)) {
        targetData._airindia["clickInfo"].depthNumber = 0;
      }
      let headerSubMenuRegex = /header[0-99]menu[0-99]/;
      if (headerSubMenuRegex.test(event.target.id)) {
        targetData._airindia["clickInfo"].depthNumber = 1;
      }
    }

    // Data layer for app store icons and social media icons
    if (
      typeof event.target.className == "string" &&
      event.target.className.includes("img-app-store")
    ) {
      targetData._airindia["clickInfo"].clickLocation = "Footer";
      targetData._airindia["clickInfo"].clickIcon = clickName;
      targetData.web["webInteractions"].name=clickName;

    }
      //corporate travel programme
    if (event.target.id == "cardBannerLink") {
      targetData._airindia["clickInfo"].clickLocation="Others"
      targetData._airindia["clickInfo"].bannerName = event.target.parentNode?.children[0].innerText;
      targetData._airindia["clickInfo"].bannerDescription = event.target.parentNode?.children[2].innerText;
}

    // Data layer for footer menu click
    let footerarr =
      event.target.parentNode?.parentNode?.parentNode?.parentNode?.parentNode
        ?.children;
    if(footerarr){
      for (let i = 0; i < footerarr.length; i++) {
          if (footerarr[i].className == "accordion-header") {
              targetData._airindia["clickInfo"].clickLocation = "Footer";
              targetData._airindia["clickInfo"].menuName=footerarr[i].innerText;
          }
        }
    }

    if (
      event.target.parentNode?.parentNode?.parentNode?.parentNode?.parentNode
        ?.parentNode?.parentNode?.parentNode?.id == "socialWrap"
    ) {
      targetData._airindia["clickInfo"].clickLocation = "Footer";
    }

    // Data layer for header menu name info
    if (event.target.id.includes("headernav")) {
      let headerTopMenuRegex = /headernav[0-9]$/;
      if (headerTopMenuRegex.test(event.target.id)) {
        let headerSection = event.target.id.replace("headernav", "");
        targetData._airindia["clickInfo"].clickLocation = "Header";
        targetData._airindia["clickInfo"].menuName= event.target.innerText;
      }
    }

    if (event.target.className == "header") {
      targetData._airindia["clickInfo"].clickLocation = "Header";
      pushDataTarget(targetData);
    } else if (
      event.target.parentNode?.parentNode?.parentNode?.children[0]?.children[0]
        ?.className == "mega-col-title"
    ) {
      targetData._airindia["clickInfo"].clickLocation = "Header";
      targetData._airindia["clickInfo"]. menuName=event.target.parentNode?.parentNode?.parentNode?.children[0]?.children[0]?.children[0]?.innerText;
      
    }    
    // Data layer for sign-in & sign-up
    if (event.target.id == "signIn") {
      targetData._airindia["clickInfo"].clickLocation = "Header";
      retrieveUrl(targetData);
      pushDataTarget(targetData);
    }

    if (
      (event.target.className == "lty-sign-in" &&
        event.target.id == "header4menu0link2") ||
      (event.target.className == "enrollnowlink" &&
        event.target.id == "header4menu0link1")
    ) {
      targetData._airindia["clickInfo"].clickLocation = "Header";
      targetData._airindia["clickInfo"].menuName= "Loyalty Mega Menu";
      retrieveUrl(targetData);
    }

    if (
      event.target.className &&
      typeof event.target.className == "string" &&
      event.target.className.includes("withoutLogin")
    ) {
      targetData._airindia["clickInfo"].clickLocation = "Header-Banner";
      retrieveUrl(targetData);
      pushDataTarget(targetData);
    }

    if (
      event.target.className == "myAccbtn" &&
      event.target.parentElement.className == "bottomBtn"
    ) {
      targetData._airindia["clickInfo"].clickLocation = "Use Points";
      retrieveUrl(targetData);
      pushDataTarget(targetData);
    }

    if (event.target.id == "nonloggedInComEnrollnowlink") {
      targetData._airindia["clickInfo"].clickLocation = "Use Points";
      retrieveUrl(targetData);
    }

    if (
      event.target.parentNode?.parentNode?.parentNode?.className ==
      "withoutLogin" || event.target.parentNode?.className == "cardCont"
    ) {
      targetData._airindia["clickInfo"].clickName = "Sign Up";
      targetData._airindia["clickInfo"].componentName = "Sign Up";
      targetData._airindia["clickInfo"].clickLocation = "Header-Banner";
      retrieveUrl(targetData);
      pushDataTarget(targetData);
    }

    // Data layer for TATA and Footer logo
    if (
      event.target.className &&
      typeof event.target.className == "string" &&
      event.target.className.includes("custom_image_component")
    ) {
      targetData._airindia["clickInfo"].clickName = "Tata Logo";
      targetData._airindia["clickInfo"].clickLocation = "Footer";
      if (event.target.localName == "img" && event.target.alt != "") {
        targetData._airindia["clickInfo"].componentName = event.target.alt;
        targetData.web["webInteractions"].name="Tata Logo";
      }
    }
    if(event.target.parentNode?.parentNode?.parentNode?.parentNode?.id=="copyright"){
      targetData._airindia["clickInfo"].clickName="AI Logo and Star Alliance";
      targetData._airindia["clickInfo"].componentName = "AI Logo and Star Alliance";
      pushDataTarget(targetData);
    }
    // Data layer for twiter section
    if (
      event.target.className &&
      typeof event.target.className == "string" &&
      (event.target.className.includes("tweet") ||
        event.target.className.includes("twitter"))
    ) {
      targetData._airindia["clickInfo"].clickDescription =
        event.target.innerText.replace(/[\n]/gm, "");
      targetData._airindia["clickInfo"].clickName = "Twitter Card";
      targetData._airindia["clickInfo"].componentName = "Twitter Card";
      targetData._airindia["clickInfo"].clickLocation = "Others";
      pushDataTarget(targetData);
    }

    if(event.target.parentNode?.className== "tweet-text-paragraph")
    {
      targetData._airindia["clickInfo"].clickDescription =
        event.target.innerText.replace(/[\n]/gm, "");
      targetData._airindia["clickInfo"].clickName = "Twitter Card";
      targetData._airindia["clickInfo"].componentName = "Twitter Card";
      targetData._airindia["clickInfo"].clickLocation = "Others";
    }
    //Data layer for no stops banner
    if (
      event.target.parentNode?.parentNode?.parentNode?.parentNode?.className ==
      "destinationSlider"
    ) {
      let banName;
      let banDescription;
        if (event.target.parentNode?.children[0].localName == "h2") {
          banName=event.target.parentNode?.children[0].innerText;
        }
        if (event.target.parentNode?.children[1].localName == "p") {
          banDescription=event.target.parentNode?.children[1].innerText;
        }
      
      targetData._airindia["clickInfo"].clickLocation = "Others";
      targetData._airindia["clickInfo"].clickComponentType = "Banner";
      targetData._airindia["clickInfo"].bannerName = event.target.parentNode?.children[0].innerText.replace(/[\n]/gm, " ");
      targetData._airindia["clickInfo"].bannerDescription= event.target.parentNode?.children[1].innerText.replace(/[\n]/gm, " ");
      }
    //San-francisco,dubai,london banner
    if (
      event.target.parentNode?.parentNode?.parentNode?.parentNode?.className ==
      "placePrice"
    ) {
      targetData._airindia["clickInfo"].bannerName=event.target.parentNode?.parentNode?.parentNode?.previousElementSibling.innerText.replace(/[\n]/gm, " ");
      
      targetData._airindia["clickInfo"].clickLocation = "Others";
      targetData._airindia["clickInfo"].clickComponentType = "Banner";
    }

    //banner for popular:mumbai to nyc,loyalty program,ask an agent,group travel,star allaince
    if (event.target.parentNode?.parentNode?.className == "galItem") {
      let newbannerdata = event.target.parentNode?.previousElementSibling;
      targetData._airindia["clickInfo"].bannerName=newbannerdata.innerText;
      targetData._airindia["clickInfo"]. bannerDescription=event.target.parentNode?.innerText.replace(/[\n]/gm, " ");
      targetData._airindia["clickInfo"].clickLocation = "Others";
      targetData._airindia["clickInfo"].clickComponentType = "Banner";
    }

    //prepare to travel
    if (event.target.parentNode?.parentNode?.parentNode?.className == "item") {
      let bnew = [];
      let bdescnew;
        if (event.target.parentNode?.parentNode?.nextElementSibling?.children[0].localName == "h3") {
          bnew = event.target.parentNode?.parentNode?.nextElementSibling?.children[0].innerText;
        }
        if (event.target.parentNode?.parentNode?.nextElementSibling?.children[1].localName == "h4") {
          bdescnew = event.target.parentNode?.parentNode?.nextElementSibling?.children[1].innerText;
        }
      targetData._airindia["clickInfo"].clickName = bnew;
      targetData._airindia["clickInfo"].clickLocation = "Others";
      targetData._airindia["clickInfo"].clickComponentType = "Banner";
      targetData._airindia["clickInfo"].bannerName=event.target.parentNode?.parentNode?.nextElementSibling?.children[0].innerText;
      targetData._airindia["clickInfo"].bannerDescription=event.target.parentNode?.parentNode?.nextElementSibling?.children[1].innerText;   
    }
    //Home Banner-owl carousal
    if (event.target.parentNode?.className == "topbarSliderLoyalty") {
      targetData._airindia["clickInfo"].clickComponentType = "Banner";
      targetData._airindia["clickInfo"].clickLocation = "Header-Banner";
      let bannerData = event.target.parentNode?.children;
      let bannerName = [];
      let bannerDescription = [];
      for (let i = 0; i < bannerData.length - 1; i++) {
        if (bannerData[i].localName == "h2") {
          bannerName.push(bannerData[i].innerText);
        }
        if (bannerData[i].localName == "p") {
          bannerDescription.push(bannerData[i].innerText);
        }
      }
      targetData._airindia["clickInfo"].bannerName = bannerName.join(" ").replace(/[\n]/gm, " ");
      targetData._airindia["clickInfo"].bannerDescription = bannerDescription.join(" ").replace(/[\n]/gm, " ");
    }

    if (event.target.parentNode?.className == "twitter-share-title") {
      targetData._airindia["clickInfo"].clickName = "Airindia X handle";
      targetData._airindia["clickInfo"].clickLocation = "Others";
    }

    // Data layer for in-flight magazine
    if (event.target.id == "opn-btn") {
      targetData._airindia["clickInfo"].clickName = event.target.title;
      targetData._airindia["clickInfo"].componentName = event.target.title;
    }

    //Data layer for partner offers,special offers
    if(event.target.className=="consolidated-card-title" 
        || event.target.className=="consolidated-card-desc"
         ||event.target.parentNode?.className == "partner_card_body"
        )
      {
         targetData._airindia["clickInfo"].clickName = event.target.parentNode?.children[0].innerText;  
         targetData._airindia["clickInfo"].clickComponentType = "URL"; 
        targetData._airindia["clickInfo"].componentID = event.target.parentNode?.children[0].innerText;
        targetData._airindia["clickInfo"].componentName=event.target.parentNode?.children[1].innerText; 
        pushDataTarget(targetData);
      }     
      if(event.target.parentNode?.parentNode?.className=="partner_card")
      {
        if(event.target.className=="img-area")
        {
          targetData._airindia["clickInfo"].clickName = event.target.parentNode?.children[0].nextElementSibling.children[0].innerText;
            targetData._airindia["clickInfo"].clickComponentType = "URL";     
           targetData._airindia["clickInfo"].componentID = event.target.parentNode?.children[0].nextElementSibling.children[0].innerText;    
           targetData._airindia["clickInfo"].componentName = event.target.nextElementSibling.children[1].innerText;
           pushDataTarget(targetData);
        }
        if(event.target.className=="partner_card_body" || event.target.className == "consolidated-card-text")
        {
          targetData._airindia["clickInfo"].clickName=event.target.children[0].innerText;
          targetData._airindia["clickInfo"].componentName=event.target.children[1].innerText;
          targetData._airindia["clickInfo"].componentID=event.target.children[0].innerText;
          pushDataTarget(targetData)
        }
      }

    // Data layer for airport information
    if (event.target.parentNode?.parentNode?.className == "acc-card") {
      targetData._airindia["clickInfo"].clickLocation = "Others";
    }
    //search-flight,manage booking,check-in,flight status
    if (
      event.target.parentNode?.parentNode?.parentNode?.parentNode?.parentNode?.className?.includes(
        "homeFormTabs"
      ) ||
      event.target.parentNode?.parentNode?.parentNode?.parentNode?.parentNode?.className?.includes(
        "homeFormOuter"
      ) ||
      event.target.parentNode?.parentNode?.parentNode?.parentNode?.parentNode?.className?.includes(
        "BookingFrom"
      ) ||
      (event.target.parentNode?.parentNode?.parentNode?.parentNode?.parentNode?.className?.includes("container-bs") 
      && event.target.parentNode?.parentNode?.parentNode?.parentNode?.parentNode?.className?.includes("formOpen"))
    )
     {
      let tabarr = event.target.parentNode?.parentNode?.parentNode?.attributes;
      if (event.target.tagName.toLowerCase() === 'ul') {
        return;
      }
      if (tabarr.length > 0) {
        for (let i = 0; i < tabarr.length; i++) {
          if (tabarr[i].value == "tab1") {
            targetData._airindia["clickInfo"].clickName=event.target.parentNode?.innerText.replace(/[\n]/gm, " ");
            targetData._airindia["clickInfo"].componentName=event.target.parentNode?.innerText.replace(/[\n]/gm, " ");
            targetData.web["webInteractions"].name="Search Flight";
          } else if (tabarr[i].value == "tab2") {
            targetData._airindia["clickInfo"].clickName=event.target.parentNode?.innerText.replace(/[\n]/gm, " ");
            targetData._airindia["clickInfo"].componentName=event.target.parentNode?.innerText.replace(/[\n]/gm, " ");
            targetData.web["webInteractions"].name="Manage Booking";
          } else if (tabarr[i].value == "tab3") {
            targetData._airindia["clickInfo"].clickName=event.target.parentNode?.innerText.replace(/[\n]/gm, " ");
            targetData._airindia["clickInfo"].componentName=event.target.parentNode?.innerText.replace(/[\n]/gm, " ");
            targetData.web["webInteractions"].name="Check In";
          } else if (tabarr[i].value == "tab4") {
            targetData._airindia["clickInfo"].clickName=event.target.parentNode?.innerText.replace(/[\n]/gm, " ");
            targetData._airindia["clickInfo"].componentName=event.target.parentNode?.innerText.replace(/[\n]/gm, " ");
            targetData.web["webInteractions"].name="Flight Status";
          }
        }
        pushDataTarget(targetData);
      }
    }

    if (dataTarget?.localName == "a") {
      if (event.target.id == "tooltipSignin") {
        targetData._airindia["clickInfo"].clickName = "Sign In";
        targetData._airindia["clickInfo"].clickLocation =
          "Use Points - Tooltip";
        targetData._airindia["clickInfo"].componentName = "Sign In";
        retrieveUrl(targetData);
      } else if (event.target.id == "toolTipSignup") {
        targetData._airindia["clickInfo"].clickName = "Sign Up";
        targetData._airindia["clickInfo"].clickLocation =
          "Use Points - Tooltip";
        targetData._airindia["clickInfo"].componentName = "Sign Up";
        retrieveUrl(targetData);
      }
      pushDataTarget(targetData);
    }

    // if (window.adobeDataLayer) {
    //   window.adobeDataLayer.push(targetData);
    // }
  }
}

function pushDataTarget(targetData) {
  if (window.adobeDataLayer) {
    window.adobeDataLayer.push(targetData);
  }
}

function retrieveUrl(targetData) {
  if (targetEnv == "prod") {
    targetData.web.webInteractions.URL = "https://aiflyingreturns.b2clogin.com";
  } else {
    targetData.web.webInteractions.URL =
      "https://flyingreturnstest.b2clogin.com";
  }
}

function SearchDataLayer() {
  let targetData1 = {
    event: "Search",
    _airindia: {
      pageName: document.title,
      pageURL: window.location.href,
      siteSection: "Search Result",
      siteSubSection: document.title,
      pageType: "AEM Page",
      siteName: "AirIndia Website",
      language: document.documentElement.lang,
      searchInfo: {
        onsiteSearchTerm: document.getElementById("AISearch").value,
        searchComponentType: "Web Site Search ",
      },
    },

    web: {
      webInteractions: {
        URL: window.location.href,
        linkClicks: {
          value: 1,
        },
        name: "Search Button",
        type: "other",
      },
    },
  };
  if(document.getElementById("Ttl-count"))
  {
    targetData1._airindia["searchInfo"].onsiteSearchResults= document.getElementById("Ttl-count").innerHTML;
  }
  else{
    targetData1._airindia["searchInfo"].onsiteSearchResults="0";
  }
  if (window.adobeDataLayer) {
    window.adobeDataLayer.push(targetData1);
  }
}
function impressionOnscroll(intersectingIndex, entry, intersectingIndexFooter)
{
  return;
  const targetData2 = {
    event: "impression",
    _airindia: {
      pageName: document.title,
      pageURL: window.location.href,
      siteSection: pageNameData,
      siteSubSection: document.title,
      pageType: "AEM Page",
      siteName: "AirIndia Website",
      language: document.documentElement.lang,
      market: "",
      // impressionInfo: {
      //   impressionDetails : entry.target.innerText.replace(/[\n]/gm, " "),
      // }
    },
  };
  if(intersectingIndex === 1){
    targetData2._airindia.impressionType = "BTF-Banner";
    targetData2._airindia.impressionDetails = "A CLASS APART. IT’S THE NEW STANDARD";
    pushDataTarget(targetData2);
  }

  if(intersectingIndex === 2){
    targetData2._airindia.impressionType = "BTF-Banner";
    targetData2._airindia.impressionDetails = "PREPARE TO TRAVEL";
    pushDataTarget(targetData2);
  }

  if(intersectingIndex === 3){
    targetData2._airindia.impressionType = "BTF-Banner";
    targetData2._airindia.impressionDetails = "FLY NONSTOP";
    pushDataTarget(targetData2);
  }

  if(intersectingIndexFooter === 0){
    targetData2._airindia.impressionType = "Footer";
    targetData2._airindia.impressionDetails = "Footer-Mega menu";
    pushDataTarget(targetData2);
  }

  if(intersectingIndexFooter === 1){
    targetData2._airindia.impressionType = "Footer";
    targetData2._airindia.impressionDetails = "Download AI App Icons";
    pushDataTarget(targetData2);
  }

  if(intersectingIndexFooter === 2){
    targetData2._airindia.impressionType = "Footer";
    targetData2._airindia.impressionDetails = "Social Media Icons";
    pushDataTarget(targetData2);
  }

  if(intersectingIndexFooter === 6){
    targetData2._airindia.impressionType = "Footer";
    targetData2._airindia.impressionDetails = "Tata logo";
    pushDataTarget(targetData2);
  }
}
let impressionCounter = 0
function impressionOnslide(event,interindex) {
  return;
  let impstoreJson=JSON.parse(window.sessionStorage.getItem("impressionData"));
  let targetData2 = {
    event: "impression",
    _airindia: {
      pageURL: window.location.href,
      pageName: document.title,
      siteSection: pageNameData,
      siteSubSection: document.title,
      pageType: "AEM Page",
      siteName: "AirIndia Website",
      language: document.documentElement.lang,
      impressionType: "Header-Banner",
    }
  };
  let impressionBanners = document.querySelectorAll(".impression-banner");
  if(impressionBanners && event?.item?.index != null && 
  impressionCounter < impressionBanners.length && interindex==0) 
  {
    impstoreJson?.impressionMatrix[0]?.bannersMatrix?.forEach((banner, index)=>{
      if(banner.bannerNavigated==false && index==event?.item?.index) {
        impressionCounter++;
        banner.bannerNavigated = true;
        targetData2._airindia.impressionDetails =
        impressionBanners[event?.item?.index].innerText.replace(/\n/g," ");
        pushDataTarget(targetData2);
        window.sessionStorage.setItem("impressionData", JSON.stringify(impstoreJson));
      }
    })
  }
}
// document.getElementById("searchpage").onload=b;
window.onload = function () {
  if (document.getElementById("searchpage")) {
    SearchDataLayer();
  }
};
if (document.getElementById("searchpage")) {
  var arr = document.querySelectorAll(".search-item a");
  for (let i = 0; i < arr.length; i++) {
    arr[i].onclick = function a() {
      let index = 0;
      if (
        parseInt(document.querySelector(".pagination-holder span").innerHTML) ==
        1
      ) {
        index = i + 1;
      } else {
        index =
          (parseInt(
            document.querySelector(".pagination-holder span").innerHTML
          ) -
            1) *
            10 +
          (i + 1);
      }
      let targetData2 = {
        event: "SearchClick",
        _airindia: {
          pageName: document.title,
          pageURL: window.location.href,
          siteSection: "serach result",
          siteSubSection: document.title,
          pageType: "AEM Page",
          siteName: "AirIndia Website",
          language: document.documentElement.lang,
          searchInfo: {
            onsiteSearchTerm: document.getElementById("AISearch").value,
            onsiteSearchResults: document.getElementById("Ttl-count").innerHTML,
            searchComponentType: "Web Site Search ",
            searchRank: index,
            pageRank: parseInt(
              document.querySelector(".pagination-holder span").innerHTML
            ),
          },
        },

        web: {
          webInteractions: {
            URL: window.location.href,
            linkClicks: {
              value: 1,
            },
            name: "Search Button",
            type: "other",
          },
        },
      };
      if (window.adobeDataLayer) {
        window.adobeDataLayer.push(targetData2);
      }
    };
  }
}
